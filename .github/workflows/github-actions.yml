name: Node.js CI

on:
    [push]
    #     branches: [ main ]
    # pull_request:
    #     branches: [ main ]

jobs:
    CI/CD:

        runs-on: ubuntu-latest

        steps:

            - name: Checkout source code
                uses: actions/checkout@v3

            - name: Set up Node
                uses: actions/setup-node@v3
                with:
                    node-version: 20.x
                    cache: 'npm'

            - name: Install dependencies
                run: npm ci

            - name: Run test e2e
                run: npm run test:e2e

            - name: Build project
                run: npm run build
            
            - name: Set up Docker Buildx
                uses: docker/setup-buildx-action@v2

            - name: Set up Docker
                uses: docker/setup-qemu-action@v2
            
            # - name: Build Docker image
            #     run: |
            #         docker build -t chronos-api .
        
            - name: Run Docker container locally
                run: |
                    docker-compose up -d --build
            
            - name: Verify if container is running
                run: |
                    docker ps
        

        